# NEXT_TASKS â€” Prioritized Backlog
Last updated: 2026-02-14

1. P0-01 Anti wrong-paste banner/fingerprint for DEV vs PROD template. Scope: add static fingerprint marker in XML + runtime check to surface a persistent warning and telemetry on mismatch. Acceptance: prod paste of `index.dev.xml` shows a visible banner and emits mismatch telemetry within 1s. Test: paste dev XML into prod slot, load home, verify banner + telemetry event.
2. P0-02 Harden Worker detection (retry/backoff, longer timeout, cache last-known-good). Scope: add retry schedule + LKG cache with TTL for `__gg_worker_ping`. Acceptance: on Slow 3G, `env.worker` remains true and `/blog` alias + SW registration stay stable. Test: throttle to Slow 3G and drop first ping; confirm `env.worker` true and SW registers.
3. P0-03 Telemetry redaction/allowlist. Scope: enforce allowlist keys and strip query/fragment from URLs before emit/log. Acceptance: telemetry payloads only include allowlisted fields and redacted URLs. Test: send telemetry with extra fields + query params; verify logs drop extras and scrub URLs.
4. P0-04 Optional self-host externals (`fuse.js`, `idb-keyval`, `instant.page`). Scope: vendor libraries into `public/assets/latest` and update imports. Acceptance: no runtime requests to jsdelivr/unpkg/instant.page. Test: reload home/search and confirm network shows only same-origin assets.
5. P1-01 Add HSTS header at Worker/edge. Scope: set `Strict-Transport-Security` with >= 6 months, includeSubDomains. Acceptance: all HTML responses include HSTS header. Test: curl home and verify HSTS header value.
6. P1-02 CSP enforcement plan (nonce/hash or reduce inline JS) with staged rollout. Scope: document migration plan + add optional enforced policy for low-risk surfaces. Acceptance: enforced CSP passes without console violations on home/post. Test: enable policy flag and load home/post; verify no CSP errors.
7. P1-03 Add HTML caching strategy for SPA navigation (stale-while-revalidate or in-memory cache). Scope: cache HTML responses for repeat navigations with explicit invalidation. Acceptance: repeat nav to same URL hits cache and reduces TTFB. Test: navigate back/forward and inspect timing + cache hits.
8. P1-04 Add offline cache for last-N pages (HTML) with size cap. Scope: store last-N HTML pages in SW cache with eviction. Acceptance: 3 last pages load offline with a size cap enforced. Test: visit 3 pages, go offline, reload each page.
9. P1-05 Focus management on SPA navigation (`#gg-main` focus). Scope: move focus to main region after navigation + ensure skiplink works. Acceptance: keyboard focus lands on `#gg-main` after SPA nav. Test: tab through skiplink, navigate, confirm focus moves.
10. P1-06 Respect `prefers-reduced-motion` for hero video autoplay and transitions. Scope: gate autoplay + view transitions on reduced-motion. Acceptance: reduced-motion users see no autoplay and no motion-heavy transitions. Test: enable reduced-motion OS setting and reload listing/home.
11. P1-07 Make search index size configurable (`max-results`) and lower default. Scope: add config for feed size and lower default to reduce payload. Acceptance: feed request uses configured `max-results`. Test: set config to 100 and verify request param.
12. P2-01 Add verifier for manifest `scope` + `id` (or `start_url` normalization). Scope: extend verifier to assert install identity fields. Acceptance: CI fails if manifest lacks `id` or `scope`. Test: remove `id` locally and run verifier to see failure.
13. P2-02 Preload `boot.js` or `main.js` for faster startup on fast networks. Scope: add `rel=preload` for primary JS on prod. Acceptance: preload appears in HTML and does not block render. Test: view-source and network preload waterfall.
14. P2-03 Add CI check for `gg-config` JSON validity and required keys. Scope: add verifier for JSON schema/required keys. Acceptance: invalid config fails CI. Test: break JSON locally and run verifier.
15. P2-04 Add Worker-side response cache policy for HTML (explicit no-store or edge caching strategy). Scope: set explicit `Cache-Control` for HTML. Acceptance: HTML responses include explicit caching header. Test: curl home and check headers.
16. P2-05 Add smoke test for `/gg-flags.json` schema and `csp_report_enabled` key. Scope: extend smoke to validate flags JSON + required keys. Acceptance: smoke fails if key missing. Test: remove key locally and run smoke.
17. P3-01 Add `hreflang` tags if multilingual/geo targeting is required. Scope: add alternate language links when multi-region is enabled. Acceptance: pages include `link rel=alternate hreflang=...`. Test: view-source and verify tags.
18. P3-02 Add robots/sitemap verification in smoke (ensure XML and robots served from Blogger). Scope: add smoke checks for `/robots.txt` and `/sitemap.xml` 200. Acceptance: smoke asserts 200 responses. Test: run smoke and verify pass.
19. P3-03 Add user-visible offline banner + retry action. Scope: show offline banner on failed navigation with retry CTA. Acceptance: banner appears on offline errors and retry triggers reload. Test: go offline, navigate, confirm banner + retry.
20. P3-04 Document Node version pinning for local dev (match CI Node 20) or update CI to match local tooling. Scope: add doc note or `.nvmrc` to align Node versions. Acceptance: local `node -v` matches CI or documentation states pin. Test: run `node -v` and compare to CI.
