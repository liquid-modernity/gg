# AGENTS.md — GAGA-ish Operational Instructions (Codex/AI)
Last updated: 2026-02-21

You are Codex running inside this repository.

This file and `docs/NAMING.md` are the ONLY operational rulebooks.
Any other docs (including GagaCodexGroundrules.docx) are concept/legacy and must not override these rules.

---

## 0) Operational Sources of Truth
- Naming + contracts: `docs/NAMING.md` (mandatory)
- Work order: `docs/ledger/GG_CAPSULE.md` (NOW/NEXT/LAST_PATCH)
- Task evidence: `docs/ledger/TASK_LOG.md` and `docs/ledger/TASK_REPORT.md`

If anything conflicts, follow `docs/NAMING.md` + this file first.

---

## 1) Non-negotiables (Process)
- Work on ONE task per run. Read `docs/ledger/GG_CAPSULE.md` and follow NEXT_TASK unless user overrides.
- Make changes inside the repo only.
- Run verification commands before committing.
- Do not push if verification fails, if secrets are detected, or if branch/remote is unexpected.
- Main-only workflow: stay on `main` (no forced feature branches).

---

## 2) Non-negotiables (Architecture + Implementation)
### 2.1 Blogger XML Template = Thin Shell
Do NOT add any feature/style JS/CSS inside Blogger XML template.
Only allowed:
1) Critical CSS inside `<b:skin>`
2) External scripts: `<script defer='defer' src='…'/>`
3) Markup skeleton + hooks required by UI
4) Native Blogger Comments (Protected Zone)

Forbidden:
- Any inline `<script>`
- Any non-critical CSS outside `<b:skin>`
- Any “feature logic” embedded in template

### 2.2 No HTML/CSS inside JavaScript (UI)
Forbidden:
- `innerHTML`, `insertAdjacentHTML`, HTML template strings containing `<...>`
- Injecting CSS rules (creating `<style>`, `style.textContent = ...`, CSS-in-JS)

Legacy exception (explicit):
- Legacy HTML-in-JS is allowed ONLY if listed in `docs/contracts/LEGACY_HTML_IN_JS_ALLOWLIST.json` + annotated.
- Every allowed legacy occurrence must have a comment on the same line or immediately above:
  - `// @gg-allow-html-in-js LEGACY:<ID>`
- No `<ID>`, no pass.

Allowed:
- Toggle classes/state (`.gg-is-*`) and set `data-gg-*` attributes
- Clone `<template id="gg-tpl-*">` that is defined in XML
- Set CSS variables only (`el.style.setProperty('--gg-x', value)`)

If legacy code exists:
- Migrate safely (non-breaking): create XML hooks/template → move CSS to CSS pipeline → refactor JS to clone/toggle → only then remove legacy.

### 2.3 Icon system (Dual)
- Default: Google Material 3 icons for most UI icons.
- `gg-ic-*` sprite is ONLY for:
  1) GAGA Social Media icons
  2) GAGA Logo SVG
  3) Icons not covered by M3

---

## 3) Native Blogger Comments (Protected Zone)
Treat Blogger native comments as a protected black box.

Rules
- Do not rename or modify any internal markup generated by the comment widget.
- Only wrap the widget with GAGA-owned containers and style via wrapper scoping.
- Do not add JS that rewrites comment DOM or intercepts submit/reply/login flows.
- Any task that touches the comment area must execute the Comments Smoke Checklist and report results in TASK_REPORT.md.

---

## 4) Naming discipline (Mandatory)
Follow `docs/NAMING.md` strictly.
Before introducing any new identifier, list it first and ensure it matches naming rules:
- IDs: `#gg-*`
- Classes: `.gg-*`, state `.gg-is-*`
- Data attrs: `data-gg-*`
- Tokens: `--gg-*`
- Events: `gg:*`
- Storage keys: `gg:*`

No “creative exceptions”. If you think an exception is needed, stop and request a task change instead of proceeding.

---

## 5) TASK LOGGING (MANDATORY)
- Append a new entry to `docs/ledger/TASK_LOG.md` for every task (never edit old entries).
- Update `docs/ledger/GG_CAPSULE.md` (overwrite) with NOW/NEXT/LAST_PATCH and current RELEASE_ID.
- Update `docs/ledger/TASK_REPORT.md` (overwrite) with full details and verification steps.
- If any step cannot be completed, record the reason in `docs/ledger/TASK_LOG.md` and `docs/ledger/TASK_REPORT.md`.

---

## 6) Owner Context
- Secrets available (GitHub Actions): `CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ACCOUNT_ID`, `CLOUDFLARE_ZONE_ID`.
- Infra goals: "Saya mau GitHub Actions harus hijau".
- Infra goals: "Saya mau deploy Cloudflare".
- Infra goals: "Saya mau preview hasil style/JS".

---

## 7) Default workflow for keyword "GG_RUN"
1) Read `docs/ledger/GG_CAPSULE.md` and identify NEXT_TASK.
2) Identify any new identifiers/hooks needed; validate against `docs/NAMING.md`.
3) Implement ONLY that task.
4) Update `docs/ledger/TASK_REPORT.md` (Task ID + Changes bullets must be present).
5) Run: ./scripts/gg auto
6) Also run explicit verification suite:
   - `npm run verify:release`
   - `npm run verify:assets`
   - `node tools/verify-template-contract.mjs`
   - `node tools/verify-router-contract.mjs`
   - `node tools/verify-budgets.mjs`
   - `node tools/verify-inline-css.mjs`
   - `node tools/verify-crp.mjs`
   - `SMOKE_LIVE_HTML=1 tools/smoke.sh`
7) If any step fails, STOP and report what failed.

---

## 8) Safety checks
- Never commit .env, keys, tokens, credentials, or private URLs.
- Abort if git status shows unexpected large changes (e.g., >200 files) unless user asked.
- If changes introduce inline JS/CSS in template or HTML/CSS injection in JS, treat as a bug and revert.
