(function(w,d){'use strict';var GG=w.GG=w.GG||{},M=GG.modules=GG.modules||{},U=M.ui=M.ui||{};function lb(n){return GG.boot&&GG.boot.loadModule?GG.boot.loadModule('ui.bucket.'+n+'.js'):Promise.reject(new Error('loadModule-missing'));}function sh(){var b=d.body;return b?((b.getAttribute('data-gg-surface')||(b.dataset&&b.dataset.ggSurface)||'')+'').toLowerCase():'';}function pg(){var b=d.body;return b?((b.getAttribute('data-gg-page')||(b.dataset&&b.dataset.ggPage)||'')+'').toLowerCase():'';}function sl(){var p=pg();if(p==='listing')return true;return !!d.querySelector('[data-gg-module="loadmore"],#postcards,.gg-labeltree,.gg-tags-page,.gg-tags-directory,#gg-sitemap,#gg-feed');}function sp(){return !!d.querySelector('main.gg-main[data-gg-surface="post"],main.gg-main[data-gg-surface="page"],.gg-post__content.post-body.entry-content,.post-body.entry-content');}function rp(){GG.app&&GG.app.rehydrate&&GG.app.rehydrate();}U.init=U.init||function(){if(U._init)return;U._init=true;var coreP=lb('core').then(function(){GG.boot&&GG.boot.init&&GG.boot.init();GG.app&&GG.app.init&&GG.app.init();});function lif(n,c){return c?coreP.then(function(){return lb(n).then(function(){if(n==='listing')w.__GG_LISTING_LOADED=true;rp();return true;});}):Promise.resolve(false);}lif('listing',sl());lif('post',sp());var sel='[data-gg-search],.gg-search-trigger';function os(){return coreP.then(function(){return lb('search').then(function(){return lb('search.rank').catch(function(){}).then(function(){lb('cmd').catch(function(){});var S=M.search;if(S){S.init&&S.init();S.open&&S.open();}});});});}function fb(t){var dock=d.querySelector('nav.gg-dock[data-gg-module="dock"]');if(t&&t.closest&&t.closest('nav.gg-dock')&&dock&&GG.core&&GG.core.state){GG.core.state.add(dock,'search');var i=dock.querySelector('.gg-dock__search input');try{i&&i.focus&&i.focus();}catch(_){}return;}try{w.location.href='/search';}catch(_){}}if(!U._searchBound){U._searchBound=true;d.addEventListener('click',function(e){var t=e&&e.target&&e.target.closest?e.target.closest(sel):null;if(!t)return;if(t.closest&&t.closest('nav.gg-dock'))return;e.preventDefault();e.stopPropagation();os().catch(function(err){w.GG_DEBUG&&console.warn('[ui] search open failed',err);fb(t);});},true);w.addEventListener('gg:search-open',function(){os().catch(function(){});});}if(w.__GG_PENDING_SEARCH||w.__ggHotkeySearchPending){w.__GG_PENDING_SEARCH=false;w.__ggHotkeySearchPending=0;os().catch(function(){});}};})(window,document);
