(function(w){'use strict';var GG=w.GG=w.GG||{};GG.modules=GG.modules||{};GG.__uiBuckets=GG.__uiBuckets||{};if(GG.__uiBuckets.search)return;GG.__uiBuckets.search=true;(function(GG,w,d){'use strict';if(!GG)return;GG.modules=GG.modules||{};GG.modules.search=GG.modules.search||(function(){var S={r:0,i:[],u:null,_p:null,_o:0,_t:null,_f:null,_m:0,_a:0,_k:0,_g:0,_b:0,a:-1,res:[],_d:0,_init:0};var R='gg_recents',L='g';function U(e){if(!e)return 0;if(e.isContentEditable)return 1;var t=(e.tagName||'').toUpperCase();return t==='INPUT'||t==='TEXTAREA'||t==='SELECT';}function H(str){return String(str||'').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim();}function A(en){var l=en&&en.link?en.link:[];for(var i=0;i<l.length;i++){if(l[i].rel==='alternate'&&l[i].href)return l[i].href;}return'';}function F(json){var en=json&&json.feed&&json.feed.entry?json.feed.entry:[],it=[];for(var i=0;i<en.length;i++){var e=en[i]||{},t=e.title&&e.title.$t?e.title.$t:'',u=A(e),s='';if(e.summary&&e.summary.$t)s=e.summary.$t;else if(e.content&&e.content.$t)s=e.content.$t;s=H(s);if(s.length>160)s=s.slice(0,160);var labs='';if(e.category&&e.category.length){var a=[];for(var c=0;c<e.category.length;c++){var term=e.category[c]&&e.category[c].term;if(term)a.push(term);}if(a.length)labs=a.join(',').toLowerCase();}if(t&&u)it.push({title:t,url:u,labels:labs,t:t.toLowerCase(),s:s.toLowerCase()});}return it;}function N(){if(S.r)return Promise.resolve(S.i);if(S._p)return S._p;S._p=LI().finally(function(){S._p=null;});return S._p;}async function LI(){try{if(!GG.services||!GG.services.api||!GG.services.api.getFeed)throw 0;var json=await GG.services.api.getFeed({summary:1,'max-results':500});var items=F(json);S.i=items;S.r=1;return items;}catch(err){S.r=0;throw err;}}function UI(){if(S.u&&S.u.root)return S.u;var host=d.getElementById('gg-dialog')||d.querySelector('.gg-dialog-host,[data-gg-ui="dialog"]');if(!host)return null;host.setAttribute('role','dialog');host.setAttribute('aria-modal','true');if(!host.getAttribute('aria-label')&&!host.getAttribute('aria-labelledby'))host.setAttribute('aria-label','Search');if(!host.hasAttribute('tabindex'))host.setAttribute('tabindex','-1');host.innerHTML='<div class="gg-search"><div class="gg-search__header"><input class="gg-search__input" type="search" placeholder="Search" aria-label="Search" aria-controls="'+L+'"/><button class="gg-search__close" type="button">Close</button></div><div class="gg-search__results" id="'+L+'" role="listbox"></div></div>';var input=host.querySelector('.gg-search__input'),results=host.querySelector('.gg-search__results'),close=host.querySelector('.gg-search__close');S.u={root:host,input:input,results:results,close:close};if(input){input.addEventListener('input',function(){if(S._d)clearTimeout(S._d);S._d=w.setTimeout(R,100);});input.addEventListener('keydown',function(e){if(e.key==='Escape'){e.preventDefault();X();return;}if(e.key==='Enter'&&(e.metaKey||e.ctrlKey)){e.preventDefault();FS();return;}if(e.key==='Enter'){e.preventDefault();if(S.a>-1&&S.res&&S.res[S.a]){OI(S.res[S.a]);}else{FS();}return;}if(e.key==='ArrowDown'||e.key==='ArrowUp'){e.preventDefault();MA(e.key==='ArrowDown'?1:-1);}});}if(results){results.addEventListener('click',function(e){var it=e.target&&e.target.closest?e.target.closest('.gg-search-item'):null;if(!it)return;e.preventDefault();OI(EI(it));});}if(close)close.addEventListener('click',function(){X();});host.addEventListener('keydown',function(e){if(e&&e.key==='Escape'){e.preventDefault();X();}});return S.u;}var DS='#gg-dock,[data-gg-dock]';function DV(el){if(!el||el.hasAttribute('hidden'))return 0;var r=el.getBoundingClientRect();return!!(r&&r.width>0&&r.height>0);}function AA(host){var dock=d.querySelector(DS);if(!DV(dock)){host.setAttribute('data-mode','center');return 0;}var r=dock.getBoundingClientRect();host.style.setProperty('--gg-anchor-x',r.left+'px');host.style.setProperty('--gg-anchor-y',r.top+'px');host.style.setProperty('--gg-anchor-w',r.width+'px');host.style.setProperty('--gg-anchor-h',r.height+'px');host.setAttribute('data-mode','dock');return 1;}function PD(){var ui=UI();if(!ui)return;AA(ui.root);}function BA(){if(S._a)return;S._a=1;w.addEventListener('resize',function(){if(!S._o)return;PD();});}var EN=null;function EH(str){if(!d||!d.createElement)return String(str||'');if(!EN)EN=d.createElement('span');EN.textContent=String(str||'');return EN.innerHTML;}function Q(u){var o=w.location.origin;return u&&u.indexOf(o)===0?u.slice(o.length):u||'';}function SB(){return d.querySelector('#gg-dock [data-gg-searchbar]')||d.querySelector('[data-gg-searchbar]');}function SO(o){var t=d.documentElement;if(t&&t.classList)t.classList[o?'add':'remove']('gg-search-open');var b=SB();if(b)b.setAttribute('aria-hidden',o?'true':'false');}function SS(){return d.querySelector('[data-gg-dock-search]');}function DS(on){var k=d.querySelector('nav.gg-dock');if(!k)return;var s=(k.getAttribute('data-gg-state')||'').replace(/\s+/g,' ').trim(),h=' '+s+' ';if(on){if(h.indexOf(' search ')<0)k.setAttribute('data-gg-state',(s?s+' ':'')+'search');return;}if(h.indexOf(' search ')<0)return;s=h.replace(' search ',' ').trim();if(s)k.setAttribute('data-gg-state',s);else k.removeAttribute('data-gg-state');}function FD(on){if(on===S._g)return;S._g=on;var h=d.documentElement;if(h&&h.classList)h.classList[on?'add':'remove']('gg-search-focus');var n=d.querySelectorAll('[data-gg-dock-action]'),i,el;for(i=0;i<n.length;i++){el=n[i];if(on){el.setAttribute('tabindex','-1');el.setAttribute('aria-hidden','true');}else{el.removeAttribute('tabindex');el.removeAttribute('aria-hidden');}}}function UF(){var w=SS(),i=w&&w.querySelector('input[type="search"],[data-gg-dock-search-input]'),on=S._o||!!(w&&w.contains(d.activeElement));FD(on);DS(on||(i&&i.value&&i.value.trim()));}function BF(){if(S._b)return;S._b=1;var w=SS(),i=w&&w.querySelector('input[type="search"],[data-gg-dock-search-input]');if(!w)return;w.addEventListener('focusin',UF);w.addEventListener('focusout',function(){setTimeout(UF,120);});if(i)i.addEventListener('blur',function(){setTimeout(function(){var p=S.u&&S.u.root&&S.u.root.contains(d.activeElement);if(!p&&!(i.value&&i.value.trim()))DS(0);},120);});}function GR(){try{var v=localStorage.getItem(R);if(v){var a=JSON.parse(v);if(Array.isArray(a))return a;}}catch(e){}return[];}function SR(url,title){if(!url||!title)return;var a=GR();for(var i=0;i<a.length;i++){if(a[i]&&a[i].url===url){a.splice(i,1);break;}}a.unshift({url:url,title:title,ts:Date.now()});if(a.length>20)a.length=20;try{localStorage.setItem(R,JSON.stringify(a));}catch(e){}}function RI(it,i){var title=EH(it.title||'');var href=EH(Q(it.url||''));return'<a class="gg-search__result gg-search-item" role="option" data-i="'+i+'" href="'+href+'">'+title+'</a>';}function RS(){var ui=UI();if(!ui)return;var r=GR(),list=[],html='',i=0;if(r&&r.length){html+='<div>Recents</div>';for(var j=0;j<r.length&&j<5;j++){var it=r[j]||{};list.push(it);html+=RI(it,i++);}}if(!list.length){ui.results.innerHTML='';S.res=[];S.a=-1;return;}ui.results.innerHTML=html;S.res=list;S.a=-1;}function SI(q){q=q.toLowerCase();var toks=q.split(/\s+/),res=[];for(var i=0;i<S.i.length;i++){var it=S.i[i]||{},t=it.t||'',s=it.s||'',l=it.labels||'';if(!t)continue;var sc=0;if(t.indexOf(q)===0)sc+=9;else if(t.indexOf(q)>0)sc+=6;for(var k=0;k<toks.length;k++){var tk=toks[k];if(!tk)continue;var p=t.indexOf(tk);if(p===0)sc+=5;else if(p>0)sc+=3;if(l&&l.indexOf(tk)>-1)sc+=2;if(s&&s.indexOf(tk)>-1)sc+=1;}if(sc>0)res.push({i:it,s:sc});}res.sort(function(a,b){return b.s-a.s;});var out=[];for(var j=0;j<res.length&&j<10;j++)out.push(res[j].i);return out;}function R(){var ui=UI();if(!ui)return;var q=(ui.input&&ui.input.value?ui.input.value:'').trim();if(!q){RS();return;}if(!S.r){N().then(R).catch(function(){});return;}var found=SI(q);S.res=found;S.a=-1;var html='',hint=found.length?'⌘↵full':'↵full';for(var i=0;i<found.length;i++){var it=found[i]||{};var title=EH(it.title||'');var href=EH(Q(it.url||''));html+='<a class="gg-search__result gg-search-item" role="option" data-i="'+i+'" href="'+href+'">'+title+'</a>';}html+='<div class="gg-search__hint">'+hint+'</div>';ui.results.innerHTML=html;}function SA(i){var r=S.u&&S.u.results;if(!r)return;var n=r.querySelectorAll('.gg-search-item');if(!n||!n.length){S.a=-1;return;}if(i<0)i=0;if(i>=n.length)i=n.length-1;var p=S.a;if(p>-1&&n[p])n[p].removeAttribute('aria-selected');var el=n[i];if(el)el.setAttribute('aria-selected','true');S.a=i;}function MA(dir){if(!S.res||!S.res.length)return;var i=S.a;if(i<0)i=dir>0?0:S.res.length-1;else{i=i+dir;if(i<0)i=S.res.length-1;else if(i>=S.res.length)i=0;}SA(i);}function EI(el){var i=parseInt(el.getAttribute('data-i'),10);if(!isNaN(i)&&S.res&&S.res[i])return S.res[i];return{url:el.getAttribute('href'),title:el.textContent||''};}function OI(it){if(!it)return;var url=it.url||'',title=it.title||'';NAV(url,title);}function FS(){var q=(S.u&&S.u.input?S.u.input.value:'').trim();if(!q)return;NAV('/search?q='+encodeURIComponent(q),'');}function NAV(url,title){if(!url)return;var same=0,href=url;try{var u=new URL(url,w.location.href);if(u.origin===w.location.origin){same=1;href=u.pathname+u.search+u.hash;}else href=u.toString();}catch(e){}if(title)SR(href,title);X();if(same&&GG.core&&GG.core.router&&typeof GG.core.router.navigate==='function')GG.core.router.navigate(href);else w.location.assign(href);}function OK(e){if(!e)return;if(e.key==='Tab')S._k=1;if(U(e.target))return;var key=(e.key||'').toLowerCase();if((e.ctrlKey||e.metaKey)&&key==='k'){e.preventDefault();S._k=1;O();}}function OC(e){var t=e&&e.target?e.target:null;if(!t||!t.closest)return;var tr=t.closest('[data-gg-search],.gg-search-trigger');if(!tr)return;e.preventDefault();e.stopPropagation();S._k=0;O();}function BT(){d.addEventListener('keydown',OK);d.addEventListener('click',OC,true);}function O(){var ui=UI();if(!ui)return;if(S._o){try{if(ui.input)ui.input.focus();}catch(e){}return;}S._o=1;S._f=d.activeElement;if(GG.ui&&GG.ui.dialog&&GG.ui.dialog.open)GG.ui.dialog.open();if(GG.ui&&GG.ui.overlay&&GG.ui.overlay.open)GG.ui.overlay.open();SO(1);UF();BA();PD();if(GG.services&&GG.services.a11y&&GG.services.a11y.inertManager){GG.services.a11y.inertManager.push(d.body,ui.root);S._m=1;}if(S._t){try{S._t();}catch(e){}S._t=null;}if(S._k&&GG.services&&GG.services.a11y&&GG.services.a11y.focusTrap){S._t=GG.services.a11y.focusTrap(ui.root,{autofocus:false});}N().then(R).catch(function(){});try{if(ui.input)ui.input.focus();}catch(e){}}function X(){if(GG.ui&&GG.ui.dialog&&GG.ui.dialog.close)GG.ui.dialog.close();if(GG.ui&&GG.ui.overlay&&GG.ui.overlay.close)GG.ui.overlay.close();SO(0);S._o=0;UF();if(S._t){try{S._t();}catch(e){}S._t=null;}if(S._m&&GG.services&&GG.services.a11y&&GG.services.a11y.inertManager)GG.services.a11y.inertManager.pop();S._m=0;var last=S._f;S._f=null;if(last&&last.focus)try{last.focus();}catch(e){}}function init(){if(S._init)return;S._init=1;if(!(GG.modules&&GG.modules.ui&&GG.modules.ui._searchBound))BT();BF();UF();}return{init:init,open:O,close:X};})();if(GG.boot&&GG.boot.onReady){GG.boot.onReady(function(){if(GG.modules&&GG.modules.search&&GG.modules.search.init)GG.modules.search.init();});}})(window.GG=window.GG||{},window,document);})(window);