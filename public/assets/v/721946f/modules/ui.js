(function(w,d){'use strict';var GG=w.GG=w.GG||{},M=GG.modules=GG.modules||{},U=M.ui=M.ui||{};function lb(n){return GG.boot&&GG.boot.loadModule?GG.boot.loadModule('ui.bucket.'+n+'.js'):Promise.reject(new Error('loadModule-missing'))}function sh(){var b=d.body;return b?((b.getAttribute('data-gg-surface')||(b.dataset&&b.dataset.ggSurface)||'')+'').toLowerCase():''}function sl(){var s=sh();if(s==='listing'||s==='feed')return true;if(s==='landing')return false;return !!d.querySelector('[data-gg-module="loadmore"],#postcards,.gg-labeltree,.gg-tags-page,.gg-tags-directory,#gg-sitemap,#gg-feed')}function sp(){return !!d.querySelector('main.gg-main[data-gg-surface="post"],main.gg-main[data-gg-surface="page"],.gg-post__content.post-body.entry-content,.post-body.entry-content')}function rp(){GG.app&&GG.app.rehydrate&&GG.app.rehydrate()}U.init=U.init||function(){if(U._init)return;U._init=true;var coreP=lb('core').then(function(){GG.boot&&GG.boot.init&&GG.boot.init();GG.app&&GG.app.init&&GG.app.init()});function lif(n,c){return c?coreP.then(function(){return lb(n).then(function(){rp();return true})}):Promise.resolve(false)}lif('listing',sl());lif('post',sp());var sel='[data-gg-search],.gg-search-trigger';function os(){return coreP.then(function(){return lb('search').then(function(){var S=M.search;if(S){S.init&&S.init();S.open&&S.open()}})})}function fb(t){var dock=d.querySelector('nav.gg-dock[data-gg-module="dock"]');if(t&&t.closest&&t.closest('nav.gg-dock')&&dock&&GG.core&&GG.core.state){GG.core.state.add(dock,'search');var i=dock.querySelector('.gg-dock__search input');try{i&&i.focus&&i.focus()}catch(_){}return}try{w.location.href='/search'}catch(_){}}if(!U._searchBound){U._searchBound=true;d.addEventListener('click',function(e){var t=e&&e.target&&e.target.closest?e.target.closest(sel):null;if(!t)return;e.preventDefault();e.stopPropagation();os().catch(function(err){w.GG_DEBUG&&console.warn('[ui] search open failed',err);fb(t)})},true);d.addEventListener('keydown',function(e){if(!e)return;var k=(e.key||'').toLowerCase();if((e.ctrlKey||e.metaKey)&&k==='k'){e.preventDefault();os().catch(function(){try{w.location.href='/search'}catch(_){}})}})}w.__GG_PENDING_SEARCH&&(w.__GG_PENDING_SEARCH=false,os())}})(window,document);
